<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport"
        content="width=device-width,initial-scale=1,viewport-fit=cover,maximum-scale=1,user-scalable=no" />
  <title>Pucci Weihnachtsmarkt</title>

  <meta name="theme-color" content="#000000" />
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />

  <style>
    :root {
      /* Branding: Pucci = schwarz/weiß, dezente Akzentfarbe */
      --bg: #000000;
      --bg-card: #111111;
      --bg-header: #111111;
      --bg-summary: #181818;
      --bg-row-label: #202020;
      --bg-count: #101010;

      --brand-accent: #f5f0e6; /* warmer heller Ton */
      --brand-border: #3a3a3a;

      --text: #ffffff;
      --text-muted: #bbbbbb;

      --plus: #1b5e20;
      --minus: #b71c1c;
      --pfand-plus: #1b5e20;
      --pfand-minus: #b71c1c;

      --radius: 0.45rem;
      --gap: 0.25rem;
      --font-size-base: 16px;
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      font-size: var(--font-size-base);
    }

    body {
      display: flex;
      justify-content: center;
      align-items: stretch;
      touch-action: manipulation;
    }

    .app {
      display: flex;
      flex-direction: column;
      width: 100%;
      max-width: 900px;
      height: 100vh;
      padding: 0.35rem;
      gap: 0.35rem;
    }

    /* ----------------- Pucci-Header ----------------- */

    .app-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: var(--bg-card);
      border-radius: var(--radius);
      padding: 0.3rem 0.55rem;
      border: 1px solid var(--brand-border);
      min-height: 42px;
    }

    .brand-logo {
      font-family: "Brush Script MT", "Segoe Script", "Pacifico", cursive;
      font-size: 1.5rem;
      line-height: 1;
      letter-spacing: 0.03em;
    }

    .brand-logo span {
      position: relative;
      padding-right: 0.3rem;
    }

    .brand-logo span::after {
      content: "";
      position: absolute;
      right: 0.12rem;
      top: -0.3rem;
      width: 0.25rem;
      height: 0.25rem;
      border-radius: 50% 50% 40% 60%;
      background: var(--brand-accent);
    }

    .header-text {
      text-align: right;
      font-size: 0.7rem;
      color: var(--text-muted);
      line-height: 1.2;
    }

    .header-text strong {
      color: var(--brand-accent);
      font-weight: 600;
    }

    /* ----------------- Summen-Header ----------------- */

    .summary-wrapper {
      background: var(--bg-summary);
      border-radius: var(--radius);
      padding: 0.35rem;
      border: 1px solid var(--brand-border);
    }

    .summary-header {
      display: grid;
      grid-template-columns: 1.2fr 0.9fr;
      grid-template-rows: auto auto auto;
      column-gap: 0.4rem;
      row-gap: 0.2rem;
      align-items: center;
      cursor: pointer;
      user-select: none;
    }

    .summary-total-box {
      grid-row: 1 / span 3;
      background: #050505;
      border-radius: calc(var(--radius) * 0.9);
      padding: 0.3rem 0.5rem;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .summary-total-label {
      font-size: 0.75rem;
      color: var(--text-muted);
    }

    .summary-total-value {
      font-size: 1.6rem;
      font-weight: 700;
      text-align: right;
      letter-spacing: 0.03em;
    }

    .summary-split-row {
      display: flex;
      align-items: center;
      justify-content: space-between;
      font-size: 0.8rem;
    }

    .summary-split-label {
      color: var(--text-muted);
    }

    .summary-split-value {
      font-weight: 600;
    }

    .summary-hint {
      grid-column: 1 / -1;
      font-size: 0.65rem;
      color: var(--text-muted);
      margin-top: 0.1rem;
    }

    /* ----------------- Main / Tabellenlayout ----------------- */

    main {
      flex: 1;
      background: var(--bg-card);
      border-radius: var(--radius);
      padding: 0.3rem;
      border: 1px solid var(--brand-border);
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      overflow: hidden;
    }

    .rows {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
      overflow: hidden;
    }

    .group-title {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--text-muted);
      margin: 0.1rem 0;
    }

    .row {
      display: grid;
      grid-template-columns: minmax(0, 1.3fr) minmax(0, 1.5fr);
      gap: 0.25rem;
      align-items: stretch;
      min-height: 46px; /* größere Touch-Fläche */
    }

    .row-label {
      background: var(--bg-row-label);
      border-radius: var(--radius);
      padding: 0.18rem 0.3rem;
      display: flex;
      flex-direction: column;
      justify-content: center;
      border: 1px solid #2b2b2b;
    }

    .row-label-main {
      font-weight: 600;
      font-size: 0.9rem;
      line-height: 1.15;
      white-space: normal;       /* darf umbrechen */
      overflow: visible;
      text-overflow: clip;
    }

    .row-label-sub {
      font-size: 0.7rem;
      color: var(--text-muted);
      line-height: 1.15;
      white-space: normal;
    }

    .row-controls {
      display: grid;
      grid-template-columns: 1.1fr auto 1.9fr;
      border-radius: var(--radius);
      overflow: hidden;
      border: 1px solid #000;
    }

    .btn {
      border: none;
      outline: none;
      font: inherit;
      color: #ffffff;
      padding: 0.4rem 0.2rem;         /* mehr Padding */
      cursor: pointer;
      user-select: none;
      font-size: 1.1rem;              /* größere Schrift */
    }

    .btn:active {
      filter: brightness(1.12);
    }

    .btn-minus {
      background: var(--minus);
      border-right: 1px solid #000000aa;
    }

    .btn-plus {
      background: var(--plus);
      border-left: 1px solid #000000aa;
    }

    .btn-minus-pfand {
      background: var(--pfand-minus);
    }

    .btn-plus-pfand {
      background: var(--pfand-plus);
    }

    .count-display {
      background: var(--bg-count);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.05rem;
      font-weight: 600;
      min-width: 2.6rem;              /* etwas breiter */
    }

    .side-info {
      display: none; /* für Smartphone nicht nötig, evtl. später für Tablet */
    }

    /* Portrait als Standard – bei Landscape aktuell kein anderes Layout nötig */
    @media (max-width: 400px) {
      :root {
        --font-size-base: 14px;
      }

      .brand-logo {
        font-size: 1.3rem;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- Pucci Kopfzeile -->
    <header class="app-header">
      <div class="brand-logo">
        <span>pucci</span>
      </div>
      <div class="header-text">
        <strong>Weihnachtsmarkt</strong><br />
        Schnelle Preishilfe für Glas &amp; Flasche
      </div>
    </header>

    <!-- Summenbereich (Tap = Reset) -->
    <section class="summary-wrapper" id="summaryHeader">
      <div class="summary-header">
        <div class="summary-total-box">
          <div class="summary-total-label">Gesamtbetrag</div>
          <div class="summary-total-value" id="grandTotal">0,00 €</div>
        </div>

        <div class="summary-split-row">
          <div class="summary-split-label">Getränke</div>
          <div class="summary-split-value" id="drinksTotal">0,00 €</div>
        </div>
        <div class="summary-split-row">
          <div class="summary-split-label">Pfand</div>
          <div class="summary-split-value" id="pfandTotal">0,00 €</div>
        </div>
        <div class="summary-split-row">
          <div class="summary-split-label">Rabatt (Flaschen)</div>
          <div class="summary-split-value" id="discountTotal">0,00 €</div>
        </div>

        <div class="summary-hint">
          Tippen auf den Summenbereich setzt alles wieder auf 0.
        </div>
      </div>
    </section>

    <!-- Hauptbereich: Buttons in Tabellen-Optik -->
    <main>
      <div class="rows" id="rows">
        <div class="group-title">Pfand gesamt</div>
        <div class="row">
          <div class="row-label">
            <div class="row-label-main">Pfand 2,00 €</div>
            <div class="row-label-sub">manuell korrigieren (Rückgabe/Mehr)</div>
          </div>
          <div class="row-controls">
            <button class="btn btn-minus btn-minus-pfand" data-id="pfand" data-op="dec">−</button>
            <div class="count-display" data-count-for="pfand">0</div>
            <button class="btn btn-plus btn-plus-pfand" data-id="pfand" data-op="inc">+</button>
          </div>
        </div>

        <div class="group-title">Heiße Getränke</div>

        <div class="row" data-item="gluehrose_glass">
          <div class="row-label">
            <div class="row-label-main">Glüh-Rosé</div>
            <div class="row-label-sub">Glas 5,00 € + Pfand</div>
          </div>
          <div class="row-controls">
            <button class="btn btn-minus" data-id="gluehrose_glass" data-op="dec">−</button>
            <div class="count-display" data-count-for="gluehrose_glass">0</div>
            <button class="btn btn-plus" data-id="gluehrose_glass" data-op="inc">+</button>
          </div>
        </div>

        <div class="row" data-item="gluehmostpunsch_glass">
          <div class="row-label">
            <div class="row-label-main">Glühmost/Punsch</div>
            <div class="row-label-sub">Glas 4,00 € + Pfand</div>
          </div>
          <div class="row-controls">
            <button class="btn btn-minus" data-id="gluehmostpunsch_glass" data-op="dec">−</button>
            <div class="count-display" data-count-for="gluehmostpunsch_glass">0</div>
            <button class="btn btn-plus" data-id="gluehmostpunsch_glass" data-op="inc">+</button>
          </div>
        </div>

        <div class="row" data-item="hotaperolhugo_glass">
          <div class="row-label">
            <div class="row-label-main">Hot Aperol/Hugo</div>
            <div class="row-label-sub">Glas 7,00 € + Pfand</div>
          </div>
          <div class="row-controls">
            <button class="btn btn-minus" data-id="hotaperolhugo_glass" data-op="dec">−</button>
            <div class="count-display" data-count-for="hotaperolhugo_glass">0</div>
            <button class="btn btn-plus" data-id="hotaperolhugo_glass" data-op="inc">+</button>
          </div>
        </div>

        <!-- Weine: erst alle Gläser -->
        <div class="group-title">Weine – Glas</div>

        <div class="row" data-item="seehas_glass">
          <div class="row-label">
            <div class="row-label-main">Seehas</div>
            <div class="row-label-sub">Glas 4,00 € + Pfand</div>
          </div>
          <div class="row-controls">
            <button class="btn btn-minus" data-id="seehas_glass" data-op="dec">−</button>
            <div class="count-display" data-count-for="seehas_glass">0</div>
            <button class="btn btn-plus" data-id="seehas_glass" data-op="inc">+</button>
          </div>
        </div>

        <div class="row" data-item="auxsee_glass">
          <div class="row-label">
            <div class="row-label-main">Auxerrois/Seegucker/Seehas Noir</div>
            <div class="row-label-sub">Glas 4,50 € + Pfand</div>
          </div>
          <div class="row-controls">
            <button class="btn btn-minus" data-id="auxsee_glass" data-op="dec">−</button>
            <div class="count-display" data-count-for="auxsee_glass">0</div>
            <button class="btn btn-plus" data-id="auxsee_glass" data-op="inc">+</button>
          </div>
        </div>

        <div class="row" data-item="premium_glass">
          <div class="row-label">
            <div class="row-label-main">GB&C/Aufrichtig Rot/Sekt</div>
            <div class="row-label-sub">Glas 5,00 € + Pfand</div>
          </div>
          <div class="row-controls">
            <button class="btn btn-minus" data-id="premium_glass" data-op="dec">−</button>
            <div class="count-display" data-count-for="premium_glass">0</div>
            <button class="btn btn-plus" data-id="premium_glass" data-op="inc">+</button>
          </div>
        </div>

        <!-- Dann alle Flaschen -->
        <div class="group-title">Weine – Flasche</div>

        <div class="row" data-item="seehas_bottle">
          <div class="row-label">
            <div class="row-label-main">Seehas</div>
            <div class="row-label-sub">Flasche 19,00 €</div>
          </div>
          <div class="row-controls">
            <button class="btn btn-minus" data-id="seehas_bottle" data-op="dec">−</button>
            <div class="count-display" data-count-for="seehas_bottle">0</div>
            <button class="btn btn-plus" data-id="seehas_bottle" data-op="inc">+</button>
          </div>
        </div>

        <div class="row" data-item="auxsee_bottle">
          <div class="row-label">
            <div class="row-label-main">Auxerrois/Seegucker/Seehas Noir</div>
            <div class="row-label-sub">Flasche 25,00 €</div>
          </div>
          <div class="row-controls">
            <button class="btn btn-minus" data-id="auxsee_bottle" data-op="dec">−</button>
            <div class="count-display" data-count-for="auxsee_bottle">0</div>
            <button class="btn btn-plus" data-id="auxsee_bottle" data-op="inc">+</button>
          </div>
        </div>

        <div class="row" data-item="premium_bottle">
          <div class="row-label">
            <div class="row-label-main">GB&C/Aufrichtig Rot/Sekt</div>
            <div class="row-label-sub">Flasche 29,00 €</div>
          </div>
          <div class="row-controls">
            <button class="btn btn-minus" data-id="premium_bottle" data-op="dec">−</button>
            <div class="count-display" data-count-for="premium_bottle">0</div>
            <button class="btn btn-plus" data-id="premium_bottle" data-op="inc">+</button>
          </div>
        </div>
      </div>

      <div class="side-info"></div>
    </main>
  </div>

  <script>
    // --- Datenmodell in Cent --------------------------
    const PFAND_PER_GLASS_CENTS = 200;

    const DRINKS = [
      // Heiße Getränke – nur Glas
      { id: 'gluehrose_glass', type: 'glass', priceCents: 500 },
      { id: 'gluehmostpunsch_glass', type: 'glass', priceCents: 400 },
      { id: 'hotaperolhugo_glass', type: 'glass', priceCents: 700 },

      // Weine – Glas + Flasche
      { id: 'seehas_glass', type: 'glass', priceCents: 400 },
      { id: 'seehas_bottle', type: 'bottle', priceCents: 1900 },
      { id: 'auxsee_glass', type: 'glass', priceCents: 450 },
      { id: 'auxsee_bottle', type: 'bottle', priceCents: 2500 },
      { id: 'premium_glass', type: 'glass', priceCents: 500 },
      { id: 'premium_bottle', type: 'bottle', priceCents: 2900 }
    ];

    // --- State ----------------------------------------
    const state = {
      counts: {},          // je ID Anzahl
      pfandAdjust: 0,      // manuelle Pfandkorrektur (in Gläsern)
      autoPfandCount: 0,   // aus Gläsern berechnet
      pfandTotalCount: 0,  // Summe Pfand (auto + adjust)
      bottleCount: 0,
      totals: {
        drinks: 0,
        pfand: 0,
        discount: 0,
        grand: 0
      }
    };

    DRINKS.forEach(d => state.counts[d.id] = 0);

    function formatCents(value) {
      const euros = value / 100;
      return euros.toLocaleString('de-DE', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      }) + ' €';
    }

    function recalcTotals() {
      let drinksTotal = 0;
      let bottleCount = 0;
      let autoPfand = 0;

      DRINKS.forEach(drink => {
        const count = state.counts[drink.id] || 0;
        drinksTotal += count * drink.priceCents;

        if (drink.type === 'glass') {
          autoPfand += count;
        } else if (drink.type === 'bottle') {
          bottleCount += count;
        }
      });

      const pfandTotalCount = autoPfand + state.pfandAdjust;
      const pfandTotal = pfandTotalCount * PFAND_PER_GLASS_CENTS;

      // Ab 6 Flaschen: 10 € Rabatt pro Flasche
      let discount = 0;
      if (bottleCount >= 6) {
          discount = bottleCount * 1000; // 10 € je Flasche
      }
      const grand = drinksTotal + pfandTotal - discount;

      state.autoPfandCount = autoPfand;
      state.pfandTotalCount = pfandTotalCount;
      state.bottleCount = bottleCount;
      state.totals.drinks = drinksTotal;
      state.totals.pfand = pfandTotal;
      state.totals.discount = discount;
      state.totals.grand = grand;
    }

    function updateUI() {
      document.getElementById('grandTotal').textContent = formatCents(state.totals.grand);
      document.getElementById('drinksTotal').textContent = formatCents(state.totals.drinks);
      document.getElementById('pfandTotal').textContent = formatCents(state.totals.pfand);

      if (state.totals.discount === 0) {
        document.getElementById('discountTotal').textContent = '0,00 €';
      } else {
        const txt = formatCents(state.totals.discount);
        document.getElementById('discountTotal').textContent = '−' + txt;
      }

      const pfandCountEl = document.querySelector('[data-count-for="pfand"]');
      if (pfandCountEl) {
        pfandCountEl.textContent = state.pfandTotalCount;
      }

      DRINKS.forEach(drink => {
        const el = document.querySelector('[data-count-for="' + drink.id + '"]');
        if (el) el.textContent = state.counts[drink.id] || 0;
      });
    }

    function resetAll() {
      DRINKS.forEach(d => state.counts[d.id] = 0);
      state.pfandAdjust = 0;
      recalcTotals();
      updateUI();
    }

    const rowsContainer = document.getElementById('rows');

    rowsContainer.addEventListener('click', function (event) {
      const button = event.target.closest('button[data-id]');
      if (!button) return;

      const id = button.dataset.id;
      const op = button.dataset.op;

      if (id === 'pfand') {
        if (op === 'inc') {
          state.pfandAdjust += 1;
        } else if (op === 'dec') {
          state.pfandAdjust -= 1; // darf negativ werden
        }
      } else {
        const drink = DRINKS.find(d => d.id === id);
        if (!drink) return;
        const current = state.counts[id] || 0;

        if (op === 'inc') {
          state.counts[id] = current + 1;
        } else if (op === 'dec' && current > 0) {
          state.counts[id] = current - 1;
        }
      }

      recalcTotals();
      updateUI();
    });

    document.getElementById('summaryHeader').addEventListener('click', function () {
      resetAll();
    });

    recalcTotals();
    updateUI();

    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function () {
        navigator.serviceWorker.register('sw.js').catch(function (err) {
          console.warn('Service Worker Registrierung fehlgeschlagen:', err);
        });
      });
    }
  </script>
</body>
</html>
