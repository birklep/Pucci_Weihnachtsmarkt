<!doctype html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Pucci Weihnachtsmarkt</title>

  <meta name="theme-color" content="#000000" />
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icons/icon-192.png" />

  <style>
    :root {
      --bg: #000000;
      --bg-header: #111111;
      --bg-panel: #1a1a1a;
      --text: #ffffff;
      --accent: #ffffff;
      --plus: #1b5e20;
      --minus: #b71c1c;
      --pfand-plus: #1b5e20;
      --pfand-minus: #b71c1c;
      --grid-gap: 0.25rem;
      --radius: 0.4rem;
      --font-size-base: 16px;
    }

    * {
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      font-size: var(--font-size-base);
    }

    body {
      display: flex;
      justify-content: center;
      align-items: stretch;
    }

    .app {
      display: flex;
      flex-direction: column;
      width: 100%;
      max-width: 900px;
      height: 100vh;
      padding: 0.4rem;
      gap: 0.4rem;
    }

    header.summary-header {
      background: var(--bg-header);
      border-radius: var(--radius);
      padding: 0.4rem 0.6rem;
      display: grid;
      grid-template-columns: 1.2fr 1fr 1fr 1fr;
      grid-template-rows: auto auto;
      align-items: center;
      cursor: pointer;
      user-select: none;
    }

    header.summary-header .total-label {
      grid-column: 1 / -1;
      font-size: 0.75rem;
      opacity: 0.8;
    }

    header.summary-header .total-value {
      font-size: 1.6rem;
      font-weight: 700;
      text-align: right;
      grid-column: 1 / -1;
    }

    header.summary-header .split-label {
      font-size: 0.7rem;
      opacity: 0.8;
      margin-top: 0.1rem;
    }

    header.summary-header .split-value {
      font-size: 0.9rem;
      font-weight: 600;
    }

    header.summary-header .split-block {
      display: flex;
      flex-direction: column;
      align-items: flex-end;
      justify-content: center;
      padding-top: 0.1rem;
    }

    main {
      flex: 1;
      background: var(--bg-panel);
      border-radius: var(--radius);
      padding: 0.4rem;
      display: flex;
      flex-direction: column;
      gap: 0.25rem;
      overflow: hidden;
    }

    .group-title {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      opacity: 0.8;
      margin-top: 0.15rem;
      margin-bottom: 0.1rem;
    }

    .rows {
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
      flex: 1;
      overflow: hidden;
    }

    .row {
      display: grid;
      grid-template-columns: minmax(0, 1.3fr) minmax(0, 1.4fr);
      gap: 0.25rem;
      align-items: stretch;
      font-size: 0.9rem;
    }

    .row-label {
      background: #262626;
      border-radius: var(--radius);
      padding: 0.25rem 0.35rem;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .row-label-main {
      font-weight: 600;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .row-label-sub {
      font-size: 0.7rem;
      opacity: 0.9;
    }

    .row-controls {
      display: grid;
      grid-template-columns: 1fr auto 2fr;
      gap: 0;
      border-radius: var(--radius);
      overflow: hidden;
      background: #000;
    }

    .btn {
      border: none;
      outline: none;
      font: inherit;
      color: #ffffff;
      padding: 0.35rem 0.2rem;
      cursor: pointer;
      user-select: none;
    }

    .btn:active {
      filter: brightness(1.2);
    }

    .btn-minus {
      background: var(--minus);
      border-right: 1px solid #000000aa;
      font-size: 1.2rem;
    }

    .btn-plus {
      background: var(--plus);
      border-left: 1px solid #000000aa;
      font-size: 1.2rem;
    }

    .btn-minus-pfand {
      background: var(--pfand-minus);
    }

    .btn-plus-pfand {
      background: var(--pfand-plus);
    }

    .count-display {
      background: #101010;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.1rem;
      font-weight: 600;
      min-width: 2.2rem;
    }

    .hint {
      font-size: 0.65rem;
      opacity: 0.7;
      margin-top: 0.1rem;
    }

    /* Landscape: etwas mehr Horizontalität */
    @media (orientation: landscape) {
      .app {
        max-width: 1100px;
      }

      header.summary-header {
        grid-template-columns: 1.3fr 1fr 1fr 1fr;
        grid-template-rows: auto auto;
      }

      main {
        flex-direction: row;
        gap: 0.4rem;
      }

      .rows {
        flex: 1.7;
      }

      .side-info {
        flex: 1;
        font-size: 0.75rem;
        padding-left: 0.3rem;
        border-left: 1px solid #333;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
      }

      .side-info > div {
        margin-bottom: 0.4rem;
      }
    }

    /* Hochformat: Side-Info unter die Buttons */
    @media (orientation: portrait) {
      .side-info {
        margin-top: 0.25rem;
        font-size: 0.7rem;
        border-top: 1px solid #333;
        padding-top: 0.25rem;
      }
    }

    /* Kleine Geräte etwas kompakter machen */
    @media (max-width: 400px) {
      :root {
        --font-size-base: 14px;
      }

      .row-label-main {
        font-size: 0.85rem;
      }

      .row-label-sub {
        font-size: 0.65rem;
      }

      .btn-minus, .btn-plus {
        font-size: 1rem;
      }

      .count-display {
        font-size: 0.95rem;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="summary-header" id="summaryHeader">
      <div class="total-label">Gesamtbetrag (Tippen = Reset)</div>
      <div class="total-value" id="grandTotal">0,00 €</div>

      <div class="split-block">
        <div class="split-label">Getränke</div>
        <div class="split-value" id="drinksTotal">0,00 €</div>
      </div>
      <div class="split-block">
        <div class="split-label">Pfand</div>
        <div class="split-value" id="pfandTotal">0,00 €</div>
      </div>
      <div class="split-block">
        <div class="split-label">Rabatt (Flaschen)</div>
        <div class="split-value" id="discountTotal">0,00 €</div>
      </div>
    </header>

    <main>
      <div class="rows" id="rows">
        <div class="group-title">Pfand gesamt</div>
        <div class="row">
          <div class="row-label">
            <div class="row-label-main">Pfand&nbsp;2,00 €</div>
            <div class="row-label-sub">manuell anpassen (Rückgabe/Mehr)</div>
          </div>
          <div class="row-controls">
            <button class="btn btn-minus btn-minus-pfand" data-id="pfand" data-op="dec">−</button>
            <div class="count-display" data-count-for="pfand">0</div>
            <button class="btn btn-plus btn-plus-pfand" data-id="pfand" data-op="inc">+</button>
          </div>
        </div>

        <div class="group-title">Heiße Getränke (Glas inkl. Pfand)</div>

        <div class="row" data-item="gluehrose_glass">
          <div class="row-label">
            <div class="row-label-main">Glüh-Rosé</div>
            <div class="row-label-sub">Glas 5,00 € + Pfand</div>
          </div>
          <div class="row-controls">
            <button class="btn btn-minus" data-id="gluehrose_glass" data-op="dec">−</button>
            <div class="count-display" data-count-for="gluehrose_glass">0</div>
            <button class="btn btn-plus" data-id="gluehrose_glass" data-op="inc">+</button>
          </div>
        </div>

        <div class="row" data-item="gluehmostpunsch_glass">
          <div class="row-label">
            <div class="row-label-main">Glühmost/Punsch</div>
            <div class="row-label-sub">Glas 4,00 € + Pfand</div>
          </div>
          <div class="row-controls">
            <button class="btn btn-minus" data-id="gluehmostpunsch_glass" data-op="dec">−</button>
            <div class="count-display" data-count-for="gluehmostpunsch_glass">0</div>
            <button class="btn btn-plus" data-id="gluehmostpunsch_glass" data-op="inc">+</button>
          </div>
        </div>

        <div class="row" data-item="hotaperolhugo_glass">
          <div class="row-label">
            <div class="row-label-main">Hot Aperol/Hugo</div>
            <div class="row-label-sub">Glas 7,00 € + Pfand</div>
          </div>
          <div class="row-controls">
            <button class="btn btn-minus" data-id="hotaperolhugo_glass" data-op="dec">−</button>
            <div class="count-display" data-count-for="hotaperolhugo_glass">0</div>
            <button class="btn btn-plus" data-id="hotaperolhugo_glass" data-op="inc">+</button>
          </div>
        </div>

        <div class="group-title">Weine (Glas &amp; Flasche)</div>

        <div class="row" data-item="seehas_glass">
          <div class="row-label">
            <div class="row-label-main">Seehas</div>
            <div class="row-label-sub">Glas 4,00 € + Pfand</div>
          </div>
          <div class="row-controls">
            <button class="btn btn-minus" data-id="seehas_glass" data-op="dec">−</button>
            <div class="count-display" data-count-for="seehas_glass">0</div>
            <button class="btn btn-plus" data-id="seehas_glass" data-op="inc">+</button>
          </div>
        </div>

        <div class="row" data-item="seehas_bottle">
          <div class="row-label">
            <div class="row-label-main">Seehas</div>
            <div class="row-label-sub">Flasche 19,00 €</div>
          </div>
          <div class="row-controls">
            <button class="btn btn-minus" data-id="seehas_bottle" data-op="dec">−</button>
            <div class="count-display" data-count-for="seehas_bottle">0</div>
            <button class="btn btn-plus" data-id="seehas_bottle" data-op="inc">+</button>
          </div>
        </div>

        <div class="row" data-item="auxsee_glass">
          <div class="row-label">
            <div class="row-label-main">Auxerrois/Seegucker/Seehas Noir</div>
            <div class="row-label-sub">Glas 4,50 € + Pfand</div>
          </div>
          <div class="row-controls">
            <button class="btn btn-minus" data-id="auxsee_glass" data-op="dec">−</button>
            <div class="count-display" data-count-for="auxsee_glass">0</div>
            <button class="btn btn-plus" data-id="auxsee_glass" data-op="inc">+</button>
          </div>
        </div>

        <div class="row" data-item="auxsee_bottle">
          <div class="row-label">
            <div class="row-label-main">Auxerrois/Seegucker/Seehas Noir</div>
            <div class="row-label-sub">Flasche 25,00 €</div>
          </div>
          <div class="row-controls">
            <button class="btn btn-minus" data-id="auxsee_bottle" data-op="dec">−</button>
            <div class="count-display" data-count-for="auxsee_bottle">0</div>
            <button class="btn btn-plus" data-id="auxsee_bottle" data-op="inc">+</button>
          </div>
        </div>

        <div class="row" data-item="premium_glass">
          <div class="row-label">
            <div class="row-label-main">Grauburg./Chardonnay/Aufricht/Sekt</div>
            <div class="row-label-sub">Glas 5,00 € + Pfand</div>
          </div>
          <div class="row-controls">
            <button class="btn btn-minus" data-id="premium_glass" data-op="dec">−</button>
            <div class="count-display" data-count-for="premium_glass">0</div>
            <button class="btn btn-plus" data-id="premium_glass" data-op="inc">+</button>
          </div>
        </div>

        <div class="row" data-item="premium_bottle">
          <div class="row-label">
            <div class="row-label-main">Grauburg./Chardonnay/Aufricht/Sekt</div>
            <div class="row-label-sub">Flasche 29,00 €</div>
          </div>
          <div class="row-controls">
            <button class="btn btn-minus" data-id="premium_bottle" data-op="dec">−</button>
            <div class="count-display" data-count-for="premium_bottle">0</div>
            <button class="btn btn-plus" data-id="premium_bottle" data-op="inc">+</button>
          </div>
        </div>
      </div>

      <div class="side-info">
        <div>
          <strong>Bedienhinweise</strong>
          <div class="hint">
            • Links (rot) = reduzieren<br>
            • Rechts (grün) = erhöhen<br>
            • Pfand wird bei allen Gläsern automatisch mitgezählt (2,00 € pro Glas).<br>
            • Pfand-Zeile oben dient zur Korrektur bei Rückgabe o. Ä.
          </div>
        </div>
        <div>
          <strong>Flaschen-Rabatt</strong>
          <div class="hint">
            Für je 6 verkaufte Flaschen (egal welche Sorte) werden automatisch
            10,00 € Rabatt abgezogen.<br>
            12 Flaschen = 20,00 € Rabatt usw.
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    // --- Datenmodell in Cent --------------------------
    const PFAND_PER_GLASS_CENTS = 200;

    const DRINKS = [
      // Heiße Getränke – nur Glas
      { id: 'gluehrose_glass', type: 'glass', priceCents: 500 },
      { id: 'gluehmostpunsch_glass', type: 'glass', priceCents: 400 },
      { id: 'hotaperolhugo_glass', type: 'glass', priceCents: 700 },

      // Weine – Glas + Flasche
      { id: 'seehas_glass', type: 'glass', priceCents: 400 },
      { id: 'seehas_bottle', type: 'bottle', priceCents: 1900 },
      { id: 'auxsee_glass', type: 'glass', priceCents: 450 },
      { id: 'auxsee_bottle', type: 'bottle', priceCents: 2500 },
      { id: 'premium_glass', type: 'glass', priceCents: 500 },
      { id: 'premium_bottle', type: 'bottle', priceCents: 2900 }
    ];

    // --- State ----------------------------------------
    const state = {
      counts: {},          // je ID Anzahl
      pfandAdjust: 0,      // manuelle Pfandkorrektur (in Gläsern)
      autoPfandCount: 0,   // aus Gläsern berechnet
      pfandTotalCount: 0,  // Summe Pfand (auto + adjust)
      bottleCount: 0,
      totals: {
        drinks: 0,
        pfand: 0,
        discount: 0,
        grand: 0
      }
    };

    // Initialisierung
    DRINKS.forEach(d => state.counts[d.id] = 0);

    // --- Hilfsfunktionen ------------------------------
    function formatCents(value) {
      const euros = value / 100;
      return euros.toLocaleString('de-DE', {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      }) + ' €';
    }

    function recalcTotals() {
      let drinksTotal = 0;
      let bottleCount = 0;
      let autoPfand = 0;

      DRINKS.forEach(drink => {
        const count = state.counts[drink.id] || 0;
        drinksTotal += count * drink.priceCents;

        if (drink.type === 'glass') {
          autoPfand += count;
        } else if (drink.type === 'bottle') {
          bottleCount += count;
        }
      });

      const pfandTotalCount = autoPfand + state.pfandAdjust;
      const pfandTotal = pfandTotalCount * PFAND_PER_GLASS_CENTS;

      const discount = Math.floor(bottleCount / 6) * 1000; // 10 € je 6 Flaschen
      const grand = drinksTotal + pfandTotal - discount;

      state.autoPfandCount = autoPfand;
      state.pfandTotalCount = pfandTotalCount;
      state.bottleCount = bottleCount;
      state.totals.drinks = drinksTotal;
      state.totals.pfand = pfandTotal;
      state.totals.discount = discount;
      state.totals.grand = grand;
    }

    function updateUI() {
      // Header
      document.getElementById('grandTotal').textContent = formatCents(state.totals.grand);
      document.getElementById('drinksTotal').textContent = formatCents(state.totals.drinks);
      document.getElementById('pfandTotal').textContent = formatCents(state.totals.pfand);
      document.getElementById('discountTotal').textContent =
        state.totals.discount === 0 ? '0,00 €' : '−' + formatCents(state.totals.discount).replace('€', '€');

      // Pfandanzahl
      const pfandCountEl = document.querySelector('[data-count-for="pfand"]');
      if (pfandCountEl) {
        pfandCountEl.textContent = state.pfandTotalCount;
      }

      // Getränkezähler
      DRINKS.forEach(drink => {
        const el = document.querySelector('[data-count-for="' + drink.id + '"]');
        if (el) {
          el.textContent = state.counts[drink.id] || 0;
        }
      });
    }

    function resetAll() {
      DRINKS.forEach(d => state.counts[d.id] = 0);
      state.pfandAdjust = 0;
      recalcTotals();
      updateUI();
    }

    // --- Event Handling -------------------------------
    const rowsContainer = document.getElementById('rows');

    rowsContainer.addEventListener('click', function (event) {
      const button = event.target.closest('button[data-id]');
      if (!button) return;

      const id = button.dataset.id;
      const op = button.dataset.op;

      if (id === 'pfand') {
        if (op === 'inc') {
          state.pfandAdjust += 1;
        } else if (op === 'dec') {
          state.pfandAdjust -= 1; // darf negativ werden
        }
      } else {
        const drink = DRINKS.find(d => d.id === id);
        if (!drink) return;
        const current = state.counts[id] || 0;

        if (op === 'inc') {
          state.counts[id] = current + 1;
        } else if (op === 'dec' && current > 0) {
          state.counts[id] = current - 1;
        }
      }

      recalcTotals();
      updateUI();
    });

    document.getElementById('summaryHeader').addEventListener('click', function () {
      resetAll();
    });

    // Initialer Render
    recalcTotals();
    updateUI();

    // --- PWA: Service Worker registrieren -------------
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', function () {
        navigator.serviceWorker.register('sw.js').catch(function (err) {
          console.warn('Service Worker Registrierung fehlgeschlagen:', err);
        });
      });
    }
  </script>
</body>
</html>
